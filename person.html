---
layout: layout.html
---

<div id="person">
</div>

<div id="photos">
</div>

<script type="text/template" id="person-template">
  <h1>{{username}}</h1>
  <p>joined {{ joined }}</p>
  {{#follows}}
  <div>
    Follows
    <ul class="follows">
      {{#follows}}
        <li><a href="/people/{{.}}">{{.}}</a></li>
      {{/follows}}
    </ul>
  </div>
  {{/follows}}
</script>

<script type="text/template" id="photos-template">
  {{#photos}}
  <img src="/data/images/{{username}}/{{image}}" style="width: 200px; height: 200px;"/>
  {{/photos}}
</script>

<script>

  var showPerson = function(username) {
    var template = Hogan.compile(document.getElementById('person-template').innerText)
    var photosTemplate = Hogan.compile(document.getElementById('photos-template').innerText)

    // render profile stuff
    fetch('/data/profiles/'+username+'.json')
      .then(function(res) { return res.json() })
      .then(function(person) {
        fetch('/data/follows/'+username+'/follows.json')
          .then(function(res) { return res.status === 200 ? res.json() : null })
          .then(function(follows) {
            person.follows = follows || []
            person.joined = fecha.format(new Date(person.joined), 'mediumDate')
            document.getElementById('person').innerHTML = template.render(person)
          })
      })
      .catch(function(err) { handleError(err, "Error loading person") })

    // render person's photos
    fetch('/data/photos/'+username+'.json')
      .then(function(res) {
        return res.status === 200 ? res.json() : null
      })
      .then(function(json) {
        if (!json) return
        var photos = Object.values(json)
        document.getElementById('photos').innerHTML = photosTemplate.render({ photos: photos, username: username })
      })
      .catch(function(err) { handleError(err, "Error loading photos") })
  }

  showPerson(window.location.pathname.split('/').pop())

</script>
